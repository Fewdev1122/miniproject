<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Garden</title>
    <link rel="stylesheet" href="{{url_for('static', filename = 'style.css')}}" />
    <link rel="stylesheet" href="{{url_for('static', filename = 'login.css')}}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet" />
    <!-- QRCode.js -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>


</head>

<body>
    <header class="head-nav">
        <div class="head-wrapper">
            <div class="head-bar-menu" id="bar-menu">
                <h3 class="head-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24">
                        <path fill="#fff"
                            d="M5 4h14q.425 0 .713.288T20 5t-.288.713T19 6H5q-.425 0-.712-.288T4 5t.288-.712T5 4m0 16q-.425 0-.712-.288T4 19v-5h-.175q-.475 0-.775-.363t-.2-.837l1-5q.075-.35.35-.575T4.825 7h14.35q.35 0 .625.225t.35.575l1 5q.1.475-.2.837t-.775.363H20v5q0 .425-.288.713T19 20t-.712-.288T18 19v-5h-4v5q0 .425-.288.713T13 20zm1-2h6v-4H6zm-.95-6h13.9zm0 0h13.9l-.6-3H5.65z" />
                    </svg>The Garden
                </h3>
                <div class="head-menu">
                    <ul class="list-menu" id="menu">
                        <li><a href="/">หน้าหลัก</a></li>
                        {% if session.get("is_admin") %}
                        <li> <button id="add_menu">เพิ่มเมนู</button></li>
                        <li><a href="#">คำสั่งซื้อ</a></li>
                        <li><a href="#">แดชบอร์ด</a></li>
                        <li>
                            <a href="{{ url_for('logout') }}"
                                onclick="return confirm('คุณแน่ใจหรือไม่ที่จะออกจากระบบ?');"
                                style="background-color: rgb(224, 67, 67);">Log out</a>
                        </li>
                        {% else %}
                        <li><a href="#">ติดตามออเดอร์</a></li>
                        <li><a href="{{ url_for('login') }}" id="self-store">สำหรับเจ้าของร้าน</a></li>
                        {% endif %}

                    </ul>
                    {% if session.get("is_admin") %}
                    {% else %}
                    <div class="basket">
                        <a href="" class="car-sell"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24">
                                <path fill="#7C5E48"
                                    d="M17 18a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2c0-1.11.89-2 2-2M1 2h3.27l.94 2H20a1 1 0 0 1 1 1c0 .17-.05.34-.12.5l-3.58 6.47c-.34.61-1 1.03-1.75 1.03H8.1l-.9 1.63l-.03.12a.25.25 0 0 0 .25.25H19v2H7a2 2 0 0 1-2-2c0-.35.09-.68.24-.96l1.36-2.45L3 4H1zm6 16a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2c0-1.11.89-2 2-2m9-7l2.78-5H6.14l2.36 5z" />
                            </svg>ตะกร้า</a>
                        <span class="cart-badge" id="cart-badge">0</span>
                    </div>
                    {% endif %}

                </div>

                <div id="cartModal" class="modal" style="z-index: 99999;">
                    <div class="modal-content">
                        <div>
                            <h3 style="color: #7C5E48;">ตะกร้าของคุณ</h3>
                            <p class="close"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                    viewBox="0 0 40 40">
                                    <path fill="#333"
                                        d="M21.499 19.994L32.755 8.727a1.064 1.064 0 0 0-.001-1.502c-.398-.396-1.099-.398-1.501.002L20 18.494L8.743 7.224c-.4-.395-1.101-.393-1.499.002a1.05 1.05 0 0 0-.309.751c0 .284.11.55.309.747L18.5 19.993L7.245 31.263a1.064 1.064 0 0 0 .003 1.503c.193.191.466.301.748.301h.006c.283-.001.556-.112.745-.305L20 21.495l11.257 11.27c.199.198.465.308.747.308a1.06 1.06 0 0 0 1.061-1.061c0-.283-.11-.55-.31-.747z" />
                                </svg></p>
                        </div>
                        <ul id="cart-list">

                        </ul>
                        <div id="cart-total" style="display: flex; justify-content: space-between;">
                            <p>รวมทั้งหมด:</p>
                            <div>
                                <span id="total-price">0</span> ฿
                            </div>

                        </div>
                        <button id="checkout"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                viewBox="0 0 24 24">
                                <g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2">
                                    <path
                                        d="M3 10V8a2 2 0 0 1 2-2h2m-4 4c1.333 0 4-.8 4-4m-4 4v4m18-4V8a2 2 0 0 0-2-2h-2m4 4c-1.333 0-4-.8-4-4m4 4v4M7 6h10m4 8v2a2 2 0 0 1-2 2h-2m4-4c-1.333 0-4 .8-4 4m0 0H7m-4-4v2a2 2 0 0 0 2 2h2m-4-4c1.333 0 4 .8 4 4" />
                                    <circle cx="12" cy="12" r="2" />
                                </g>
                            </svg>ชำระเงิน</button>

                        <div id="qrModal" class="modal" style="display:none;">
                            <div class="modal-content">
                                <span id="closeQrBtn">&times;</span>
                                <h3>สแกนเพื่อชำระเงิน</h3>
                                <div id="qrCodeDiv"></div>
                                <p id="qrAmount"></p>
                            </div>
                        </div>




                    </div>
                </div>
                <div class="ham-menu" id="ham-menu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 16 16">
                        <path fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="1.5" d="M2.75 12.25h10.5m-10.5-4h10.5m-10.5-4h10.5" />
                    </svg>
                </div>
            </div>
        </div>
    </header>
    {% block content %}{% endblock %}



    <script src="{{ url_for('static', filename='register.js') }}"></script>
    <script src="{{ url_for('static', filename='main.js') }}"></script>
    <script>

        document.getElementById("checkout").onclick = async () => {
            if (cart.length === 0) {
                alert("ตะกร้าว่าง!");
                return;
            }

            const res = await fetch("/create_qr", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ cart: cart })  // ส่ง cart จริง
            });

            const data = await res.json();

            // ✅ ใช้ data.qr_payload ที่ Flask ส่งมา
            document.getElementById("qrCodeDiv").innerHTML =
                `<img src="data:image/png;base64,${data.qr_payload}" alt="PromptPay QR" />`;

            document.getElementById("qrAmount").innerText = `ยอดรวม: ${data.total} บาท`;
            document.getElementById("qrModal").style.display = "block";
        };


        document.getElementById("closeQrBtn").onclick = () => {
            document.getElementById("qrModal").style.display = "none";
        };




    </script>
</body>


</html>