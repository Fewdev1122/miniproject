{% extends "layout.html" %}
{% block content %}
<h1>แดชบอร์ดยอดขาย</h1>

<form method="get" action="/dashboard" style="text-align:center; margin-bottom:20px;">
  <label>หมวดหมู่:</label>
  <select name="category">
    <option value="">ทั้งหมด</option>
    <option value="coffee" {% if selected_category=='กาแฟ' %}selected{% endif %}>กาแฟ</option>
    <option value="tea" {% if selected_category=='ชา' %}selected{% endif %}>ชา</option>
    <option value="food" {% if selected_category=='ของคาว' %}selected{% endif %}>ของคาว</option>
    <option value="dessert" {% if selected_category=='ของหวาน' %}selected{% endif %}>ของหวาน</option>
  </select>

  <label>ช่วงเวลา:</label>
  <select name="date_filter" id="date_filter">
    <option value="today" {% if selected_date_filter=='today' %}selected{% endif %}>วันนี้</option>
    <option value="month" {% if selected_date_filter=='month' %}selected{% endif %}>เดือนนี้</option>
    <option value="year" {% if selected_date_filter=='year' %}selected{% endif %}>ปีนี้</option>
    <option value="custom" {% if selected_date_filter=='custom' %}selected{% endif %}>กำหนดเอง</option>
  </select>

  <input type="date" name="start_date" id="start_date" style="display:none;" value="{{ start_date }}">
  <input type="date" name="end_date" id="end_date" style="display:none;" value="{{ end_date }}">

  <button type="submit">ดูสถิติ</button>
</form>

<div id="salesChart" style="width:80%;height:500px;margin:auto;"></div>

<script src="https://cdn.plot.ly/plotly-2.29.0.min.js"></script>
<script>
document.getElementById("date_filter").addEventListener("change", function() {
    if (this.value === "custom") {
        document.getElementById("start_date").style.display = "inline";
        document.getElementById("end_date").style.display = "inline";
    } else {
        document.getElementById("start_date").style.display = "none";
        document.getElementById("end_date").style.display = "none";
    }
});

// Plotly chart
const labels = {{ labels|tojson }};
const values = {{ values|tojson }};

if (labels.length > 0) {
    const data = [{
        x: labels,
        y: values,
        type: 'bar',
        marker: { color: '#3498db' }
    }];

    const layout = {
        title: 'ยอดขายตามหมวดหมู่',
        xaxis: { title: 'หมวดหมู่' },
        yaxis: { title: 'จำนวนขาย' },
        margin: { t: 50, l: 50, r: 50, b: 100 }
    };

    Plotly.newPlot('salesChart', data, layout);
} else {
    document.getElementById("salesChart").innerHTML = "<p style='text-align:center;'>ไม่มีข้อมูลสำหรับช่วงเวลานี้</p>";
}


</script>
{% endblock %}
