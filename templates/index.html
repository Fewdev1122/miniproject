{% extends "layout.html" %}
{% block content %}

    <section class="menu-search-box">
        <div class="menu-search-container">
            <div class="details">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="37" height="37" viewBox="0 0 512 512">
                        <path fill="#fff" fill-rule="evenodd"
                            d="M256 42.667C138.18 42.667 42.667 138.179 42.667 256c0 117.82 95.513 213.334 213.333 213.334c117.822 0 213.334-95.513 213.334-213.334S373.822 42.667 256 42.667m0 384c-94.105 0-170.666-76.561-170.666-170.667S161.894 85.334 256 85.334c94.107 0 170.667 76.56 170.667 170.666S350.107 426.667 256 426.667m26.714-256c0 15.468-11.262 26.667-26.497 26.667c-15.851 0-26.837-11.2-26.837-26.963c0-15.15 11.283-26.37 26.837-26.37c15.235 0 26.497 11.22 26.497 26.666m-48 64h42.666v128h-42.666z" />
                    </svg>
                    รับหน้าร้านเท่านั้น - สั่งล่วงหน้าอย่างน้อย 15 นาที
                </p>
            </div>
            <div class="menu-search-list">
                <ul class="cagatory-menu">
                    <li class="cagatory active" data-target="all">ทั้งหมด</li>
                    <li class="cagatory" data-target="coffee">กาแฟ</li>
                    <li class="cagatory" data-target="tea">ชา</li>
                    <li class="cagatory" data-target="food">ของคาว</li>
                    <li class="cagatory" data-target="dessert">ของหวาน</li>
                </ul>
            </div>
            {% if is_admin %}
            <button id="add_menu">เพิ่มเมนู</button>
            <div class="bg-black" id="bgblack"></div>
            <div class="popup-form" id="popup">
                <form action="/add-menu" method="post" enctype="multipart/form-data" class="add" id="add_id">
                    <h3 style="font-size: 20px; color: #583e2c; margin-bottom: 1rem">
                        เพิ่มเมนู
                    </h3>
                    <label for="file" class="add-file">
                        <div class="container-file">
                            <div class="ic-upload">
                                <svg id="icon-up" xmlns="http://www.w3.org/2000/svg" width="65" height="65"
                                    viewBox="0 0 24 24">
                                    <g fill="none" stroke="#808080" stroke-linecap="round" stroke-linejoin="round"
                                        stroke-width="2">
                                        <path stroke-dasharray="20" stroke-dashoffset="20"
                                            d="M12 15h2v-6h2.5l-4.5 -4.5M12 15h-2v-6h-2.5l4.5 -4.5">
                                            <animate attributeName="d" begin="0.5s" dur="1.5s" repeatCount="indefinite"
                                                values="M12 15h2v-6h2.5l-4.5 -4.5M12 15h-2v-6h-2.5l4.5 -4.5;M12 15h2v-3h2.5l-4.5 -4.5M12 15h-2v-3h-2.5l4.5 -4.5;M12 15h2v-6h2.5l-4.5 -4.5M12 15h-2v-6h-2.5l4.5 -4.5" />
                                            <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.4s"
                                                values="20;0" />
                                        </path>
                                        <path stroke-dasharray="14" stroke-dashoffset="14" d="M6 19h12">
                                            <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s"
                                                dur="0.2s" values="14;0" />
                                        </path>
                                    </g>
                                </svg>
                            </div>
                            <img id="img-suc" style="
                    display: none;
                    justify-self: center;
                    max-width: 280px;
                    max-height: 50px;
                  " src="" alt="" />
                            <h3>เพิ่มภาพประกอบเมนู</h3>
                            <p>** แนะนำ สูง220px กว้าง480px **</p>
                        </div>
                    </label>
                    <input type="file" name="menu_image" style="margin-bottom: 1rem; display: none" id="file"
                        accept="image/*" required />
                    <label for="text-menu">ชื่อเมนู</label>
                    <input type="text" id="text-menu" name="menu_name" placeholder="ชื่อเมนู" class="input-add"
                        required />
                    <label for="number-price">ราคา</label>
                    <input type="number" id="number-price" name="menu_price" placeholder="ราคา" class="input-add"
                        required />
                    <textarea name="detail-menu-add" class="detail-menu-add" id=""
                        placeholder="พิมพ์รายละเอียด"></textarea>
                    <div class="checkbox">
                        <label><input type="checkbox" name="option_type" value="1" />
                            ร้อน</label>
                        +
                        <input type="number" name="option_type_1" style="width: 25px; padding-left: 0.25rem" />
                        <label><input type="checkbox" name="option_type" value="2" />
                            เย็น</label>
                        +
                        <input type="number" name="option_type_2" style="width: 25px; padding-left: 0.25rem" />
                        <label><input type="checkbox" name="option_type" value="3" />
                            ปั่น</label>
                        +
                        <input type="number" name="option_type_3" style="width: 25px; padding-left: 0.25rem" />
                    </div>
                    <select name="cagatories-add" id="option-add">
                        <option value="">กรุณาเลือกหมวด</option>
                        <option value="coffee">กาแฟ</option>
                        <option value="tea">ชา</option>
                        <option value="food">ของคาว</option>
                        <option value="dessert">ของหวาน</option>
                    </select>
                    <button type="submit" id="add-list-menu">เพิ่มเมนู</button>
                    <button type="button" id="del-popup">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 14 14">
                            <path fill="#808080" fill-rule="evenodd"
                                d="M1.707.293A1 1 0 0 0 .293 1.707L5.586 7L.293 12.293a1 1 0 1 0 1.414 1.414L7 8.414l5.293 5.293a1 1 0 0 0 1.414-1.414L8.414 7l5.293-5.293A1 1 0 0 0 12.293.293L7 5.586z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </form>
            </div>
            {% endif %}
            <div class="menu-search">
                <input type="text" placeholder="ค้นหาเมนู..." id="search" />
                <span class="icon-search"><svg id="searchBtn" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24">
                        <path fill="#B5B5B5"
                            d="M9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l5.6 5.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-5.6-5.6q-.75.6-1.725.95T9.5 16m0-2q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" />
                    </svg></span>
            </div>
        </div>
    </section>
    <section class="list-store-menu">
        <div class="list-store-con" id="menu-list">

        </div>
    </section>

    <script src="{{ url_for('static', filename='main.js') }}"></script>
    <script>
        console.log("start");
        fetch("api/menus")
            .then((res) => res.json())
            .then((data) => {
                console.log("Menus:", data.menus);
                const menulist = document.getElementById("menu-list");
                menulist.innerHTML = "";
                
                data.menus.forEach((menu) => {
                    let listOptHTML = ''
                    let buttonDel = ''
                    if (data.is_admin == true){
                        buttonDel = `<button  class="delAdmin" data-id="${menu.id_menu}"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="#fff" d="m9.4 16.5l2.6-2.6l2.6 2.6l1.4-1.4l-2.6-2.6L16 9.9l-1.4-1.4l-2.6 2.6l-2.6-2.6L8 9.9l2.6 2.6L8 15.1zM7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21z"/></svg></button>`
                    }else{
                        buttonDel = ''
                    }
                    data.menu_option_prices.forEach((optionMenu) =>{
                        if (optionMenu.id_menu == menu.id_menu){
                            data.options.forEach((opt)=>{
                                if (opt.id_option == optionMenu.id_option){
                                    let nameMenu = opt.option_name
                                    let priceMenu = optionMenu.price_add
                                    let add = ` + ${priceMenu}`
                                    if (priceMenu == 0){
                                        listOptHTML += `<li>${nameMenu}</li>`;
                                    }else{
                                        listOptHTML += `<li>${nameMenu}${add}</li>`;

                                    }    
                                }
                            })
                                                
                        }
                    })
                    
                    const categoryClass = menu.category;
                    const box = document.createElement("div");
                    box.className = `list-store-box ${categoryClass}`;
                
                    box.innerHTML = `
                    
                    <div class="img-menu">
                        ${buttonDel}
                        <img src="${menu.img_path}" alt="">
                    </div>
                    <div class="detail-all">
                        <div class="name-price">
                            <h3 class="name-menu">${menu.menu_name}</h3>
                            <h3 class="price-menu">${menu.menu_price} <span>฿</span></h3>
                        </div>
                        <p class="detail-menu">${menu.details}</p>
                        <div class="option-add">
                            <ul class="option-menu">
                               ${listOptHTML}
                                
                            </ul>
                            <button class="add-menu" data-id="${menu.id_menu}">เพิ่ม</button>
                        </div>
                    </div>
                    `;
                    menulist.appendChild(box);
                });
                Search();
            })
            .catch((err) => {
                console.error("Fetch failed:", err);
            });
    </script>
    
{% endblock %}